---
sidebar_position: 5
---

# Fix Endpoint

Create a Pull Request with dependency updates to fix vulnerabilities.

## Endpoint

```
POST /api/fix
```

:::note Status
This endpoint is currently disabled due to lock file synchronization issues. Updates to manifest files (package.json, go.mod) don't automatically update lock files, causing subsequent scan failures.
:::

:::note Database Required
This endpoint requires a database to be configured. See [Database Setup](/self-hosting/database-setup).
:::

## Request

### Headers

| Header | Value | Required |
|--------|-------|----------|
| `Content-Type` | `application/json` | Yes |

### Body

```json
{
  "installation_id": 12345678,
  "scan_report_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### Parameters

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `installation_id` | integer | Yes | GitHub App installation ID |
| `scan_report_id` | string | Yes | UUID of the scan report to fix |

## Response

### Success

```json
HTTP/1.1 200 OK
Content-Type: application/json

{
  "status": "success",
  "pull_request": {
    "number": 42,
    "url": "https://github.com/myorg/myrepo/pull/42",
    "title": "fix(deps): Update vulnerable dependencies",
    "fixes_count": 3
  }
}
```

### Already Fixed

```json
HTTP/1.1 200 OK
Content-Type: application/json

{
  "status": "success",
  "message": "No fixable vulnerabilities found"
}
```

### Error Responses

**Scan Report Not Found**

```json
HTTP/1.1 404 Not Found
Content-Type: application/json

{
  "status": "error",
  "error": {
    "code": "scan_not_found",
    "message": "Scan report not found"
  }
}
```

**No Write Access**

```json
HTTP/1.1 403 Forbidden
Content-Type: application/json

{
  "status": "error",
  "error": {
    "code": "no_write_access",
    "message": "GitHub App does not have write access to this repository"
  }
}
```

## How It Works

When a fix is requested:

1. **Fetch scan report** from database
2. **Identify fixable vulnerabilities** (those with a `fixed_version`)
3. **Create a new branch** from the PR's base branch
4. **Update manifest files** with fixed versions:
   - npm: `package.json`
   - Go: `go.mod`
   - Python: `requirements.txt`, `pyproject.toml`
5. **Create Pull Request** targeting the original branch

## Generated PR Content

### PR Title

```
fix(deps): Update vulnerable dependencies
```

### PR Body

```markdown
## Security Updates

This PR updates the following vulnerable dependencies:

| Package | From | To | CVE | Severity |
|---------|------|-----|-----|----------|
| lodash | 4.17.20 | 4.17.21 | CVE-2021-23337 | HIGH |
| minimist | 1.2.5 | 1.2.6 | CVE-2021-44906 | CRITICAL |

---

_Automatically generated by dpendx_
```

### Commit Message

```
fix(deps): update vulnerable dependencies

Updates:
- lodash: 4.17.20 → 4.17.21 (CVE-2021-23337)
- minimist: 1.2.5 → 1.2.6 (CVE-2021-44906)
```

## Examples

### curl

```bash
curl -X POST https://your-dpendx.com/api/fix \
  -H "Content-Type: application/json" \
  -d '{
    "installation_id": 12345678,
    "scan_report_id": "550e8400-e29b-41d4-a716-446655440000"
  }'
```

### Via Check Run Action

In the GitHub PR checks, clicking the "Fix Vulnerabilities" button triggers this endpoint automatically. The button appears when:

1. Vulnerabilities have available fixes
2. Database is configured
3. Feature is enabled

## Limitations

### Current Limitations

1. **Lock files not updated** - Only manifest files are modified
2. **Single ecosystem** - PR may only fix one ecosystem
3. **No transitive fixes** - Only direct dependencies updated

### Supported Ecosystems

| Ecosystem | Manifest Updated | Lock File Updated |
|-----------|-----------------|-------------------|
| npm | ✅ package.json | ❌ package-lock.json |
| Go | ✅ go.mod | ❌ go.sum |
| Python | ✅ requirements.txt | ❌ |
| Others | ❌ Not supported | ❌ |

## Workarounds

Until the fix endpoint is fully functional, manually update dependencies:

### npm

```bash
npm install lodash@4.17.21
npm audit fix
```

### Go

```bash
go get github.com/pkg/errors@v0.9.2
go mod tidy
```

### Python

```bash
pip install lodash==4.17.21
pip freeze > requirements.txt
```

## Rate Limits

| Limit | Value |
|-------|-------|
| Requests per hour | 10 per installation |
| Concurrent fixes | 1 per repository |

## Next Steps

- [Data models](/api-reference/data-models)
- [Scan endpoint](/api-reference/scan-endpoint)
- [Troubleshoot common issues](/troubleshooting/common-issues)
